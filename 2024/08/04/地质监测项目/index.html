<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="秋水">
    
    <title>
        
            地质监测项目 |
        
        qiushui‘s blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"tai769.github.io","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"知识，技能，心态"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                qiushui‘s blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">地质监测项目</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">秋水</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2024-08-04 01:35:35
    </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="这个项目我觉得有三个亮点"><a href="#这个项目我觉得有三个亮点" class="headerlink" title="这个项目我觉得有三个亮点"></a>这个项目我觉得有三个亮点</h3><blockquote>
<ol>
<li><p>数据入库量比较大，我们做了多次优化，能够一个小时内将百万数据全部入库，tps实测达到2000左右</p>
</li>
<li><p>由于我们处理的数据量非常庞大，数据存储和管理成为了一大挑战。我们的数据库架构经过精心设计，以支持海量数据的高效存储和管理。</p>
</li>
<li><p>数据分析模块，需要查询某一区域的历史沉降信息去做对比，我们对数据库字段进行优化，添加字段来提升效率</p>
</li>
</ol>
</blockquote>
<h3 id="你们是如何优化这个数据接口，支持到tps2000的，把数据存储和管理做的比较好。"><a href="#你们是如何优化这个数据接口，支持到tps2000的，把数据存储和管理做的比较好。" class="headerlink" title="你们是如何优化这个数据接口，支持到tps2000的，把数据存储和管理做的比较好。"></a>你们是如何优化这个数据接口，支持到tps2000的，把数据存储和管理做的比较好。</h3><blockquote>
<p>随着数据量的不断增加，我们的数据处理需求也越来越复杂。最初，我们的数据仅限于北京某个区域，每天晚上收集数据并存储在MySQL中，第二天早晨9点前处理结果并返回给领导。然而，随着数据覆盖北京全域，数据量大幅增长，导致接口负载加重。</p>
<p>最初我们仅需将数据上传到数据库，但随着数据量的激增，MySQL的查询性能逐渐下降。为了解决这一问题，我们引入了Kafaka进行削峰，缓解了部分压力。然而，随着索引和数据量继续增加，MySQL的查询速度依然无法满足需求。我们尝试按月份水平分表，但Mysql单机性能仍然是瓶颈。</p>
<p><strong>为什么选择kafka</strong></p>
<p>首先我们对比了rabbitmq rocketmq kafka，ActiveMQ</p>
<p>首先kafka在处理百万级数据上表现比较好，性能不错，第二个对数我们的业务来说，数据保证其实不是那么重要，rocketmq 和rabbitmq对数据保证更友好，开发和部署kafka也比较简单， 社区生态kafka也比较庞大。所以我们选择了kafka</p>
<p>因此，我们考虑使用数据库进行改进。我们对比了MyCat和MongoDB。MyCat通过读写分离提高并发性能，但在高并发情况下，MyCat本身可能成为瓶颈，因为所有数据都要进过mycat。最终，我们选择了MongoDB，因为它本身就是替代传统关系型数据库的存在，支持高并发写入。</p>
<p>我们用kafka削峰把数据存到mongodb，之后采用异步把消息转发到另一个topic，然后采用多路复用的思想，接受多条消息之后，批处理到mysql中，减少了mysql的io操作</p>
<p>后期，为了解决大量过期数据的问题，我们可以考虑引入大数据，将过期数据存储在HBase中，实现冷热数据分离，从而进一步优化数据存储和查询性能。但我们暂时还没做，因为大家都是java，还没有考虑大数据技术，所以我们后期可以考虑数据库分冷热表。</p>
</blockquote>
<h3 id="kafka-出现临时堆积-怎么处理"><a href="#kafka-出现临时堆积-怎么处理" class="headerlink" title="kafka 出现临时堆积 怎么处理"></a>kafka 出现临时堆积 怎么处理</h3><p>我们在项目中并没有遇到Kafka消息堆积的问题，主要原因有以下几点：</p>
<ol>
<li>我们的数据是按照时间来存储的，每条消息在生产后会存储8小时，8小时后自动删除。因此，Kafka中的数据能够及时清理，避免堆积。</li>
<li>我们的Kafka机器配置良好，能够容纳大量数据，处理能力充足。</li>
</ol>
<p>尽管如此，我们也了解并掌握了一些应对消息队列中间件堆积问题的处理方式：</p>
<ol>
<li><strong>快速扩容</strong>：在消息堆积时，迅速增加Kafka集群的节点，提升集群的处理能力。</li>
<li><strong>消息转发</strong>：将堆积的消息转发到其他的Topic，进行分流处理，缓解单一Topic的压力。</li>
<li><strong>增加消费者</strong>：通过增加消费者实例来加快消息消费速度，从而减轻消息堆积的现象。</li>
</ol>
<p>在我们的项目中，目标是快速处理数据而不是让数据堆积。为了实现这一目标，我们选择了分布式数据库来提高数据处理速度和效率。MySQL在单机性能上的限制促使我们转向了MongoDB，这种分布式数据库支持高并发写入和查询，能够更好地满足我们日益增长的数据处理需求。</p>
<h3 id="那么多数据，数据库怎么存"><a href="#那么多数据，数据库怎么存" class="headerlink" title="那么多数据，数据库怎么存"></a>那么多数据，数据库怎么存</h3><p>我们在初期规划的时候，考虑到这么多数据了，所以按照实际的场景去测试，一张表存多少数据查询效率不受影响，我们查下来差不多一个月的数据，也就是一亿左右，因为我们做联合索引的，单条数据的大小不是特别大，所以查询效率也ok。</p>
<h3 id="分表之后数据是如何查询的"><a href="#分表之后数据是如何查询的" class="headerlink" title="分表之后数据是如何查询的"></a>分表之后数据是如何查询的</h3><p>我们计算前的数据是分表查询的，都是有日期的，有了日期我们就可以知道它落在那一个表上，至于计算结果，这些数据量不是很大，我们是没有分表的。</p>
<h3 id="告警系统是怎么做的呢"><a href="#告警系统是怎么做的呢" class="headerlink" title="告警系统是怎么做的呢"></a>告警系统是怎么做的呢</h3><p>这个告警系统大致的流程是我们有一个沉降数据的阈值，比如单日阈值，单月阈值，超过这个范围，我们就会触发报警，我们就会通过短信通知区域的负责人。但取到数据以后，他们好像使用的是引擎规则，还能动态定义，这块我没怎么了解。</p>
<h3 id="kafaka消息丢失的情况是如何考虑的"><a href="#kafaka消息丢失的情况是如何考虑的" class="headerlink" title="kafaka消息丢失的情况是如何考虑的"></a>kafaka消息丢失的情况是如何考虑的</h3><p>我们的数据是设备数据，是可以允许丢失的，并且kafaka数据会丢这个情况，我们也在网上调研过，基于各种各样的配置可能确实存在丢的情况，但是我们不是业务信息，我们是日志信息所以可丢，但是我们也尽量做了ack，来保证消息不丢。</p>
<h3 id="生产者和消费者如何保证消息不丢失"><a href="#生产者和消费者如何保证消息不丢失" class="headerlink" title="生产者和消费者如何保证消息不丢失"></a>生产者和消费者如何保证消息不丢失</h3><p><strong>生产者</strong> 我们设置了 ack确认为all，然后重试次数为3次。</p>
<p><strong>消费者</strong> 数据批量处理， 手动提交偏移量，日志记录（记录错误信息到日志表），数据核对通过雪花算法加入id</p>
<p>然后我们三台机器，10个消费者，10个生产者，10个分区，一个消费者对应一个分区提交ack，速度很快。</p>
<h3 id="写入mongodb的数据一定保证可以写入到mysql吗"><a href="#写入mongodb的数据一定保证可以写入到mysql吗" class="headerlink" title="写入mongodb的数据一定保证可以写入到mysql吗"></a>写入mongodb的数据一定保证可以写入到mysql吗</h3><p>消费kafaka之后，我们会优先保证写入到mongodb，随后转发到另一个kfaka的topic中，因为我们的统计数据都是从mongodb查询的，所以后期mysql数据库消费快慢无关只做存档，哪怕数据丢了也不大，业务特性是决定我们的数据是可以丢失的，三天以后的数据，我们也会定时删除mongodb。</p>
<p>但其实我们也做了数据一致性检查，我们通过插入数据之前通过雪花算法生成标识，然后我们在数据插入后，我们可以通过获取id来对比，消息发送失败数据的id会重新写入消息队列，进行消费。</p>
<h3 id="你的数据是如何保证写入到mongodb的"><a href="#你的数据是如何保证写入到mongodb的" class="headerlink" title="你的数据是如何保证写入到mongodb的"></a>你的数据是如何保证写入到mongodb的</h3><p><strong>Kafka进行削峰</strong>：利用Kafka作为消息队列，将数据流进行削峰处理，能够缓解突发高并发写入压力，平滑数据写入过程。</p>
<p><strong>Kafka配置</strong>：</p>
<ul>
<li><strong>ACK设置为ALL</strong>：配置Kafka的生产者确认机制为<code>all</code>，确保消息在所有副本都写入成功后才确认，提高数据写入的可靠性。</li>
<li><strong>重试机制</strong>：配置重试次数为3次，可以在网络抖动或暂时性故障情况下重试，进一步提高消息写入的可靠性。</li>
</ul>
<p><strong>MongoDB单节点处理能力</strong>：根据你的调研，MongoDB单节点可以处理300万条数据的写入，因此在现阶段不需要进行分片。MongoDB本身具有较高的写入性能，特别是在配置合理的情况下。</p>
<h3 id="数据校对"><a href="#数据校对" class="headerlink" title="数据校对"></a>数据校对</h3><p>然后我们还有就是消息在入库的时候，我们使用的是雪花算法进行唯一标识，如果有失败的消息，我们最后有一个数据一致性的检验，通过雪花id获取到消费失败的消息，然后重新入队列。</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：地质监测项目</li>
        <li>Post author：秋水</li>
        <li>Create time：2024-08-04 01:35:35</li>
        <li>
            Post link：tai769.github.io2024/08/04/地质监测项目/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2024/09/08/%E7%A7%8B%E6%8B%9B%E6%8A%95%E9%80%92%E8%AE%B0%E5%BD%95/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">秋招投递记录</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2024/07/06/%E5%85%B3%E4%BA%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0%E7%9A%84%E9%80%89%E6%8B%A9/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">关于线程池参数的选择</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>&nbsp;-&nbsp;
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">秋水</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E6%88%91%E8%A7%89%E5%BE%97%E6%9C%89%E4%B8%89%E4%B8%AA%E4%BA%AE%E7%82%B9"><span class="nav-number">1.</span> <span class="nav-text">这个项目我觉得有三个亮点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%A0%E4%BB%AC%E6%98%AF%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E8%BF%99%E4%B8%AA%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%94%AF%E6%8C%81%E5%88%B0tps2000%E7%9A%84%EF%BC%8C%E6%8A%8A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%92%8C%E7%AE%A1%E7%90%86%E5%81%9A%E7%9A%84%E6%AF%94%E8%BE%83%E5%A5%BD%E3%80%82"><span class="nav-number">2.</span> <span class="nav-text">你们是如何优化这个数据接口，支持到tps2000的，把数据存储和管理做的比较好。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kafka-%E5%87%BA%E7%8E%B0%E4%B8%B4%E6%97%B6%E5%A0%86%E7%A7%AF-%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">kafka 出现临时堆积 怎么处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%A3%E4%B9%88%E5%A4%9A%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%80%8E%E4%B9%88%E5%AD%98"><span class="nav-number">4.</span> <span class="nav-text">那么多数据，数据库怎么存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E8%A1%A8%E4%B9%8B%E5%90%8E%E6%95%B0%E6%8D%AE%E6%98%AF%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E7%9A%84"><span class="nav-number">5.</span> <span class="nav-text">分表之后数据是如何查询的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%8A%E8%AD%A6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84%E5%91%A2"><span class="nav-number">6.</span> <span class="nav-text">告警系统是怎么做的呢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kafaka%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%83%85%E5%86%B5%E6%98%AF%E5%A6%82%E4%BD%95%E8%80%83%E8%99%91%E7%9A%84"><span class="nav-number">7.</span> <span class="nav-text">kafaka消息丢失的情况是如何考虑的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%E5%A4%B1"><span class="nav-number">8.</span> <span class="nav-text">生产者和消费者如何保证消息不丢失</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5mongodb%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%80%E5%AE%9A%E4%BF%9D%E8%AF%81%E5%8F%AF%E4%BB%A5%E5%86%99%E5%85%A5%E5%88%B0mysql%E5%90%97"><span class="nav-number">9.</span> <span class="nav-text">写入mongodb的数据一定保证可以写入到mysql吗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%A0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%86%99%E5%85%A5%E5%88%B0mongodb%E7%9A%84"><span class="nav-number">10.</span> <span class="nav-text">你的数据是如何保证写入到mongodb的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E5%AF%B9"><span class="nav-number">11.</span> <span class="nav-text">数据校对</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>







<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
